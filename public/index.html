<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Police Data</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.1.1/socket.io.dev.js"></script>
    <link href="styles.css" rel="stylesheet" />
</head>

<body>
    <base href="https://polygit.org/px-*+PredixDev+*/webcomponentsjs+v1.0.22/polymer+v2.3.1/components/">
    <script src="webcomponentsjs/webcomponents-lite.js"></script>
    <link rel="import" href="polymer/polymer.html" />
    <link rel="import" href="px-theme/px-theme-styles.html" />
    <link rel="import" href="px-map-marker-group/px-map-marker-group.html" />
    <link rel="import" href="px-map/px-map.html" />
    <link rel="import" href="px-map/px-map-tile-layer.html" />
    <link rel="import" href="px-map/px-map-marker-group.html" />
    <link rel="import" href="px-d3-imports/px-polygit-imports-d3.html" />
    <link rel="import" href="px-map/px-map-popup-data.html" />
    <link rel="import" href="px-map/px-map-marker-static.html" />
    <link rel="import" href="px-branding-bar/px-branding-bar.html" />
    <link rel="import" href="px-simple-horizontal-bar-chart/px-simple-horizontal-bar-chart.html" />
    <link rel="import" href="px-map/px-map-control-zoom.html" />
    <link rel="import" href="px-map-control-zoom/px-map-control-zoom.html" />
    <link rel="import" href="px-key-value-pair/px-key-value-pair.html" />
    <link rel="import" href="px-dropdown/px-dropdown.html"/>


    <script src="https://d3js.org/d3.v3.min.js"></script>

    <custom-style>
        <style include="px-theme-styles" is="custom-style"></style>
    </custom-style>
    <px-branding-bar application-title="Predix Design System"></px-branding-bar>


    <div style="height:600px; width:800px; display:flex; padding-right:10px;">
        <px-map zoom="11" flex-to-size lat="32.772404" lng="-117.029327">
            <px-map-control-zoom position="topright"></px-map-control-zoom>

            <div id="output">

            </div>

            <px-map-tile-layer url='https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png'>
            </px-map-tile-layer>
        </px-map>
    </div>


    <div class="graph" style="position: absolute; top:60px; right: 15px; padding-right: 40px  ">
        <h1> Priority Call Stats</h1>

        <div id="output1" style="height:200px; width: 150px; ">

        </div>
    </div>


    <div class="calls" style="position: absolute; bottom:10px; right: 15px; padding-right: 40px  ">
        <h1>TOTAL CALLS</h1>

        <div id="output2" style="height:200px; width: 150px; ">
            
        </div>


       
        <button id='button'>click me</button>
    </div>

    <px-simple-horizontal-bar-chart 
    bar-labels="values" 
    legend-labels='["Level 1", "Level 2", "Level3", "Level4"]' 
    chart-data='[0,0,0,0]' id="bar-graph">

    </px-simple-horizontal-bar-chart>









    <script>    

        //Create a connection
        var socket = io.connect('http://localhost:4000');
        let calls_this_year = 0;
        let priority1 = 0; //id 1
        let priority2 = 0 // id 2
        let priority3 = 0 //id 3
        let priority4 = 0 //id 4

        document.getElementById('button').onclick = () => {
            socket.emit('changeTime', 10000);
        }

        socket.on('simulated-data', function (data) {

            //All values of each json object
            let incident_num = data.A;
            let date_time = data.B;
            let day = data.C;
            let stno = data.D;
            let street_name = data.F;
            let street_type = data.G;
            let full_address = data.H;
            let call_type = data.I;
            let disposition = data.J;
            let beat = data.K;
            let priority = data.L;
            let latitude = data.M;
            let longitude = data.N;

            output.innerHTML += '<px-map-marker-static id="Godzilla" style="display:none;" lat="' + latitude + '" lng="' + longitude + '" type="info">' +
                '<px-map-popup-data title="' + incident_num + '" data=\'{"Year":"' + date_time
                + '","Date":"' + date_time
                + '","Location":"' + full_address
                + '","Level of Emergency":"' + priority
                + '","Call Type":"' + call_type
                + '","CITY":"San diego"}\'>'
                + '</px-map-popup-data> </px-map-marker-static>';




            switch (Number(priority)) { // Regulating the count to be higher/lower  
                case 1:
                    priority1++;

                    break;
                case 2:
                    priority2++;

                    break;
                case 3:
                    priority3++;

                    break;
                case 4:
                    priority4++;;
                    break;
            }

            //Increments bar graph
            document.getElementById('bar-graph').setAttribute('chart-data', '[' + priority1 + ',' + priority2 + ',' + priority3 + ',' + priority4 + ']');
            

            if (Number(priority) > 0) {
                calls_this_year++;
            }
            var x;
            if (Number(calls_this_year) > 1) {
                x = "calls"

            }
            else {
                x = "call"
            }

            console.log(calls_this_year);
            output2.innerHTML = '<px-key-value-pair ' +
                'label="This Year" ' +
                'value= "' + calls_this_year + '" ' +
                'uom=" ' + x + '" size="alpha"></px-key-value-pair>';

        });



    </script>

</body>

</html>
